{
	"name": "Unpiviot",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"linkedService": {
						"referenceName": "ls_mylake587",
						"type": "LinkedServiceReference"
					},
					"name": "UnpivotDataset"
				}
			],
			"sinks": [
				{
					"linkedService": {
						"referenceName": "mylinkedserviceforazuresql",
						"type": "LinkedServiceReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "derivedColumn1"
				},
				{
					"name": "select1"
				},
				{
					"name": "unpivot1"
				},
				{
					"name": "select2"
				},
				{
					"name": "unpivot2"
				},
				{
					"name": "derivedColumn2"
				},
				{
					"name": "derivedColumn3"
				},
				{
					"name": "join1"
				},
				{
					"name": "select3"
				}
			],
			"scriptLines": [
				"source(output(",
				"          Company as string,",
				"          {Product Group} as string,",
				"          {Product SubClass} as string,",
				"          {Reporting ID} as string,",
				"          { Item} as string,",
				"          {Item name} as string,",
				"          {FOB/NON FOB} as string,",
				"          {Jan Qty} as short,",
				"          {Jan Inv Sales} as double,",
				"          {Jan MTL} as double,",
				"          {Jan Contribution} as double,",
				"          {Feb Qty} as short,",
				"          {Feb Inv Sales} as double,",
				"          {Feb MTL} as double,",
				"          {Feb Contribution} as double,",
				"          {Mar Qty} as short,",
				"          {Mar Inv Sales} as double,",
				"          {Mar MTL} as double,",
				"          {Mar Contribution} as double,",
				"          {Apr Qty} as short,",
				"          {Apr Inv Sales} as double,",
				"          {Apr MTL} as double,",
				"          {Apr Contribution} as double,",
				"          {May Qty} as short,",
				"          {May Inv Sales} as double,",
				"          {May MTL} as double,",
				"          {May Contribution} as double,",
				"          {Jun Qty} as short,",
				"          {Jun Inv Sales} as double,",
				"          {Jun MTL} as double,",
				"          {Jun Contribution} as double,",
				"          {Jul Qty} as double,",
				"          {Jul Inv Sales} as double,",
				"          {Jul MTL} as double,",
				"          {Jul Contribution} as double,",
				"          {Aug Qty} as double,",
				"          {Aug Inv Sales} as double,",
				"          {Aug MTL} as double,",
				"          {Aug Contribution} as double,",
				"          {Sep Qty} as double,",
				"          {Sep Inv Sales} as double,",
				"          {Sep MTL} as double,",
				"          {Sep Contribution} as double,",
				"          {Oct Qty} as double,",
				"          {Oct Inv Sales} as double,",
				"          {Oct MTL} as double,",
				"          {Oct Contribution} as double,",
				"          {Nov Qty} as double,",
				"          {Nov Inv Sales} as double,",
				"          {Nov MTL} as double,",
				"          {Nov Contribution} as double,",
				"          {Dec Qty} as double,",
				"          {Dec Inv Sales} as double,",
				"          {Dec MTL} as double,",
				"          {Dec Contribution} as double",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     format: 'excel',",
				"     fileSystem: 'input',",
				"     fileName: '6+6 2022 Sales and Contribution data for Azure upload- BAU & BNZ.xlsx',",
				"     sheetName: 'Jan-May Act-Jun-Dec 6+6 Data',",
				"     firstRowAsHeader: true) ~> UnpivotDataset",
				"UnpivotDataset derive(each(match(type != 'string'), $$ = toString($$))) ~> derivedColumn1",
				"derivedColumn1 select(mapColumn(",
				"          Company,",
				"          {Product Group},",
				"          {Product SubClass},",
				"          {Reporting ID},",
				"          { Item},",
				"          {Item name},",
				"          {FOB/NON FOB},",
				"          {Jan Qty},",
				"          {Feb Qty},",
				"          {Mar Qty},",
				"          {Apr Qty},",
				"          {May Qty},",
				"          {Jun Qty},",
				"          {Jul Qty},",
				"          {Aug Qty},",
				"          {Sep Qty},",
				"          {Oct Qty},",
				"          {Nov Qty},",
				"          {Dec Qty}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select1",
				"select1 unpivot(output(",
				"          Month as string,",
				"          Qty as string",
				"     ),",
				"     ungroupBy(Company,",
				"          {Product Group},",
				"          {Product SubClass},",
				"          {Reporting ID},",
				"          { Item},",
				"          {Item name},",
				"          {FOB/NON FOB}),",
				"     lateral: true,",
				"     ignoreNullPivots: false) ~> unpivot1",
				"derivedColumn1 select(mapColumn(",
				"          Company,",
				"          {Product Group},",
				"          {Product SubClass},",
				"          {Reporting ID},",
				"          { Item},",
				"          {Item name},",
				"          {FOB/NON FOB},",
				"          {Jan Inv Sales},",
				"          {Feb Inv Sales},",
				"          {Mar Inv Sales},",
				"          {Apr Inv Sales},",
				"          {May Inv Sales},",
				"          {Jun Inv Sales},",
				"          {Jul Inv Sales},",
				"          {Aug Inv Sales},",
				"          {Sep Inv Sales},",
				"          {Oct Inv Sales},",
				"          {Nov Inv Sales},",
				"          {Dec Inv Sales}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select2",
				"select2 unpivot(output(",
				"          Month as string,",
				"          {Inv Sales} as string",
				"     ),",
				"     ungroupBy(Company,",
				"          {Product Group},",
				"          {Product SubClass},",
				"          {Reporting ID},",
				"          { Item},",
				"          {Item name},",
				"          {FOB/NON FOB}),",
				"     lateral: true,",
				"     ignoreNullPivots: false) ~> unpivot2",
				"unpivot2 derive(Month = substring(Month, 1, 3)) ~> derivedColumn2",
				"unpivot1 derive(Month = substring(Month, 1, 3)) ~> derivedColumn3",
				"derivedColumn2, derivedColumn3 join(unpivot2@{ Item} == unpivot1@{ Item}",
				"     && derivedColumn2@Month == derivedColumn3@Month,",
				"     joinType:'inner',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> join1",
				"join1 select(mapColumn(",
				"          Company = unpivot2@Company,",
				"          {Product Group} = unpivot2@{Product Group},",
				"          {Product SubClass} = unpivot2@{Product SubClass},",
				"          {Reporting ID} = unpivot2@{Reporting ID},",
				"          { Item} = unpivot2@{ Item},",
				"          {Item name} = unpivot2@{Item name},",
				"          {FOB/NON FOB} = unpivot2@{FOB/NON FOB},",
				"          Month = derivedColumn2@Month,",
				"          {Inv Sales},",
				"          Qty",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select3",
				"select3 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'table',",
				"     store: 'sqlserver',",
				"     schemaName: 'dbo',",
				"     tableName: 'Salesdata',",
				"     insertable: true,",
				"     updateable: false,",
				"     deletable: false,",
				"     upsertable: false,",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     errorHandlingOption: 'stopOnFirstError') ~> sink1"
			]
		}
	}
}